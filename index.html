<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Flappy ðŸŽˆ - Single File</title>
<style>
  :root{--canvas-max-width:420px;}
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(#0f172a,#071327);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
    -webkit-tap-highlight-color: transparent;
    height:100vh;
  }
  .wrap{
    width:100%;
    max-width:var(--canvas-max-width);
    padding:14px;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  canvas{
    width:100%;
    height:auto;
    border-radius:12px;
    box-shadow:0 12px 30px rgba(2,6,23,0.7), inset 0 -8px 20px rgba(0,0,0,0.15);
    touch-action: none;
    display:block;
    background:transparent;
  }

  /* Overlay (menu / game over) */
  #overlay{
    position:fixed;
    left:0; right:0; top:0; bottom:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:auto;
  }
  .panel{
    width:92%;
    max-width:360px;
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    border-radius:14px;
    padding:22px;
    text-align:center;
    color:#fff;
    backdrop-filter: blur(6px);
    box-shadow:0 8px 30px rgba(2,6,23,0.6);
  }
  h1{font-size:28px;margin-bottom:8px}
  p.sub{color:rgba(255,255,255,0.85);margin-bottom:18px}
  .btn{
    display:inline-block;
    padding:12px 26px;
    border-radius:12px;
    border:0;
    cursor:pointer;
    font-weight:600;
    font-size:16px;
    box-shadow:0 6px 14px rgba(0,0,0,0.35);
  }
  .btn-play{
    background: linear-gradient(135deg,#ffd39f,#ff944d);
    color:#fff;
  }
  .btn-ghost{
    margin-left:12px;
    background:transparent;
    color:#fff;
    border:1px solid rgba(255,255,255,0.12);
  }

  /* Small instructions */
  .hint{margin-top:12px;color:rgba(255,255,255,0.7);font-size:13px}
  /* Score badge */
  .score-badge{
    position:fixed;
    top:18px;
    left:50%;
    transform:translateX(-50%);
    background:linear-gradient(180deg,#ffffff22,#00000022);
    padding:6px 14px;
    border-radius:999px;
    color:#fff;
    font-weight:700;
    font-size:18px;
    pointer-events:none;
    text-shadow:0 2px 8px rgba(0,0,0,0.6);
  }

  @media (max-width:420px){
    h1{font-size:22px}
    .panel{padding:16px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <canvas id="gameCanvas" width="400" height="600" aria-label="Flappy bird canvas"></canvas>
  </div>

  <!-- Overlay (menu/gameover) -->
  <div id="overlay">
    <div class="panel" id="menuPanel">
      <h1>Flappy ðŸŽˆ 3D</h1>
      <p class="sub">Tap anywhere to flap. Pass pipes to score.</p>
      <button class="btn btn-play" id="playBtn">Play</button>
      <button class="btn btn-ghost" id="creditsBtn" style="margin-left:12px">Credits</button>
      <div class="hint">Tap canvas or press Space / â†‘ to flap</div>
    </div>
  </div>

  <div class="score-badge" id="scoreBadge" style="display:none">Score: 0</div>

<script>
/* ---------- Responsive & DPR setup ---------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const CSS_WIDTH = 400;
const CSS_HEIGHT = 600;
function setupCanvas(){
  const DPR = window.devicePixelRatio || 1;
  canvas.width = CSS_WIDTH * DPR;
  canvas.height = CSS_HEIGHT * DPR;
  canvas.style.width = Math.min(420, Math.max(300, window.innerWidth - 28)) + 'px';
  canvas.style.height = ( (CSS_HEIGHT / CSS_WIDTH) * parseFloat(canvas.style.width) ) + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0); // scale drawing to logical CSS pixels
}
setupCanvas();
window.addEventListener('resize', () => { setupCanvas(); drawOnce(); });

/* ---------- Game constants & state ---------- */
const WIDTH = CSS_WIDTH;
const HEIGHT = CSS_HEIGHT;
const GROUND_H = 80;
const PIPE_SPEED = 3.2;
const PIPE_W = 64;
const PIPE_GAP = 150;
const SPAWN_INTERVAL = 95; // frames
let state = 'menu'; // 'menu' | 'playing' | 'gameover'

let bird, pipes, frameCount, score, rafId, gravity, jumpForce;

/* ---------- DOM elements ---------- */
const overlay = document.getElementById('overlay');
const menuPanel = document.getElementById('menuPanel');
const playBtn = document.getElementById('playBtn');
const creditsBtn = document.getElementById('creditsBtn');
const scoreBadge = document.getElementById('scoreBadge');

/* ---------- Initialize / Start / Restart ---------- */
function initGame(){
  bird = { x: 72, y: HEIGHT/2, r: 20, vy: 0 };
  pipes = [];
  frameCount = 0;
  score = 0;
  gravity = 0.45;
  jumpForce = -9;
  state = 'playing';
  scoreBadge.style.display = 'block';
  updateScoreBadge();
}

function startFromMenu(){
  initGame();
  hideOverlay();
  cancelAnimationFrame(rafId);
  rafId = requestAnimationFrame(loop);
}

function showMenu(){
  state = 'menu';
  overlay.style.display = 'flex';
  menuPanel.innerHTML = `
    <h1>Flappy ðŸŽˆ 3D</h1>
    <p class="sub">Beautiful background â€¢ 3D pipes â€¢ Mobile friendly</p>
    <button class="btn btn-play" id="playBtnInner">Play</button>
    <button class="btn btn-ghost" id="creditsBtnInner">About</button>
    <div class="hint">Tap canvas or press Space / â†‘ to flap</div>
  `;
  // attach newly created buttons
  document.getElementById('playBtnInner').addEventListener('click', startFromMenu);
  document.getElementById('creditsBtnInner').addEventListener('click', ()=> {
    menuPanel.innerHTML = `
      <h1>About</h1>
      <p class="sub">This is a single-file Flappy-style game using canvas.<br/>Tap to flap and pass pipes to score.</p>
      <button class="btn btn-play" id="backBtn">Back</button>
    `;
    document.getElementById('backBtn').addEventListener('click', showMenu);
  });
}

function showGameOver(){
  state = 'gameover';
  overlay.style.display = 'flex';
  menuPanel.innerHTML = `
    <h1>Game Over</h1>
    <p class="sub">Your score: <strong>${score}</strong></p>
    <button class="btn btn-play" id="restartBtn">Restart</button>
    <button class="btn btn-ghost" id="menuBtn">Menu</button>
    <div class="hint">Tap Restart to play again</div>
  `;
  document.getElementById('restartBtn').addEventListener('click', ()=> {
    startFromMenu(); // restart immediately
  });
  document.getElementById('menuBtn').addEventListener('click', ()=> {
    scoreBadge.style.display = 'none';
    showMenu();
  });
}

function hideOverlay(){
  overlay.style.display = 'none';
}

/* ---------- Drawing helpers ---------- */
function drawBackground(frame){
  // Sky gradient
  const g = ctx.createLinearGradient(0,0,0,HEIGHT);
  g.addColorStop(0, '#8fd3ff');
  g.addColorStop(1, '#a6ecff');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,WIDTH,HEIGHT);

  // Parallax rolling distant hills / skyline (faint)
  ctx.save();
  ctx.globalAlpha = 0.12;
  ctx.fillStyle = '#0c4b4a';
  for(let i=0;i<3;i++){
    const offset = (frame * 0.2 * (i+1)) % (WIDTH+200);
    ctx.beginPath();
    const yBase = 280 + i*40;
    ctx.moveTo(-200+offset, yBase);
    for(let x=-200; x<=WIDTH+200; x+=30){
      ctx.lineTo(x, yBase + Math.sin((x+frame*0.5+i*30)/60) * (18 + i*6));
    }
    ctx.lineTo(WIDTH+200, HEIGHT);
    ctx.lineTo(-200, HEIGHT);
    ctx.closePath();
    ctx.fill();
  }
  ctx.restore();

  // Moving clouds (multiple layers)
  for(let i=0;i<6;i++){
    const speed = 0.45 + (i%3)*0.25;
    let x = (frame * speed * (i+1)) % (WIDTH + 200) - 100;
    let y = 60 + (i%3)*30;
    ctx.beginPath();
    ctx.fillStyle = 'rgba(255,255,255,0.92)';
    roundedCloud(x, y, 40 + (i%3)*8);
    ctx.fill();
  }

  // Ground
  const grd = ctx.createLinearGradient(0, HEIGHT-GROUND_H, 0, HEIGHT);
  grd.addColorStop(0, '#3aa76b');
  grd.addColorStop(1, '#1e5d38');
  ctx.fillStyle = grd;
  ctx.fillRect(0, HEIGHT-GROUND_H, WIDTH, GROUND_H);

  // subtle ground decoration stripes
  ctx.globalAlpha = 0.06;
  for(let i=0;i<20;i++){
    ctx.fillRect(i*40 + (frame*0.6%40), HEIGHT - 18, 24, 6);
  }
  ctx.globalAlpha = 1;
}

function roundedCloud(cx, cy, size){
  // draws a fluffy cloud by overlapping arcs
  ctx.beginPath();
  ctx.arc(cx - size*0.6, cy, size*0.6, 0, Math.PI*2);
  ctx.arc(cx - size*0.2, cy - size*0.25, size*0.7, 0, Math.PI*2);
  ctx.arc(cx + size*0.2, cy, size*0.6, 0, Math.PI*2);
  ctx.arc(cx + size*0.6, cy, size*0.45, 0, Math.PI*2);
  ctx.closePath();
}

/* ---------- Bird ---------- */
function drawBird(){
  ctx.save();
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.font = `${bird.r*2}px system-ui, serif`;
  // shadow
  ctx.shadowColor = 'rgba(0,0,0,0.35)';
  ctx.shadowBlur = 8;
  ctx.fillText('ðŸŽˆ', bird.x, bird.y);
  ctx.restore();
}

/* ---------- Pipes ---------- */
function drawPipe(p){
  // 3D gradient for pipe body
  const grad = ctx.createLinearGradient(p.x,0,p.x+p.w,0);
  grad.addColorStop(0, '#66d089');
  grad.addColorStop(1, '#1e7a3f');

  // Top pipe
  ctx.fillStyle = grad;
  ctx.fillRect(p.x, 0, p.w, p.top);
  // Top lip
  ctx.fillStyle = '#9fe7b3';
  ctx.fillRect(p.x - 6, p.top - 20, p.w + 12, 18);

  // Bottom pipe
  ctx.fillStyle = grad;
  ctx.fillRect(p.x, HEIGHT - p.bottom, p.w, p.bottom);
  // Bottom lip
  ctx.fillStyle = '#9fe7b3';
  ctx.fillRect(p.x - 6, HEIGHT - p.bottom, p.w + 12, 18);

  // right edge shadow to add depth
  ctx.fillStyle = 'rgba(0,0,0,0.18)';
  ctx.fillRect(p.x + p.w - 10, 0, 10, p.top);
  ctx.fillRect(p.x + p.w - 10, HEIGHT - p.bottom, 10, p.bottom);
}

/* ---------- Update & physics ---------- */
function flap(){
  if(state !== 'playing') return;
  bird.vy = jumpForce;
  // clamp upwards not too strong
  if(bird.vy < -12) bird.vy = -12;
}

function update(){
  if(state !== 'playing') return;

  frameCount++;

  // physics
  bird.vy += gravity;
  bird.y += bird.vy;
  // gentle rotation could be added but emoji rendering is fine

  // spawn pipes
  if(frameCount % SPAWN_INTERVAL === 2){
    const top = Math.floor( Math.random() * (HEIGHT - GROUND_H - PIPE_GAP - 120) ) + 40;
    pipes.push({
      x: WIDTH + 20,
      w: PIPE_W,
      top: top,
      bottom: HEIGHT - top - PIPE_GAP,
      passed: false
    });
  }

  // move pipes, check score & collisions
  for(let i = 0; i < pipes.length; i++){
    const p = pipes[i];
    p.x -= PIPE_SPEED;

    // scoring: when pipe's right edge passes left of bird and not counted
    if(!p.passed && (p.x + p.w) < bird.x - bird.r){
      p.passed = true;
      score++;
      updateScoreBadge();
    }

    // collision with top
    const collidedHorizontally = (bird.x + bird.r > p.x) && (bird.x - bird.r < p.x + p.w);
    if(collidedHorizontally){
      if(bird.y - bird.r < p.top || bird.y + bird.r > HEIGHT - p.bottom){
        endGame();
        return;
      }
    }
  }

  // remove off-screen pipes
  pipes = pipes.filter(p => p.x + p.w > -40);

  // ground collision
  if(bird.y + bird.r > HEIGHT - GROUND_H){
    endGame();
    return;
  }
  // ceiling collision
  if(bird.y - bird.r < 0){
    bird.y = bird.r;
    bird.vy = 0;
  }
}

/* ---------- End game ---------- */
function endGame(){
  if(state !== 'playing') return;
  state = 'gameover';
  // small delay for visual effect then show overlay
  setTimeout(()=> showGameOver(), 520);
}

/* ---------- Score UI ---------- */
function updateScoreBadge(){
  scoreBadge.textContent = `Score: ${score}`;
}

/* ---------- Main render loop ---------- */
function drawOnce(){
  // single frame draw for resize
  ctx.clearRect(0,0,WIDTH,HEIGHT);
  drawBackground(frameCount);
  pipes.forEach(drawPipe);
  drawBird();
  // HUD
  ctx.save();
  ctx.fillStyle = 'rgba(255,255,255,0.98)';
  ctx.font = '20px system-ui, sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText(`Score: ${score}`, 12, 30);
  ctx.restore();
}

function loop(){
  // update logic
  update();
  // draw everything
  ctx.clearRect(0,0,WIDTH,HEIGHT);
  drawBackground(frameCount);
  pipes.forEach(drawPipe);
  drawBird();

  // HUD Score (center top)
  ctx.save();
  ctx.fillStyle = 'rgba(255,255,255,0.96)';
  ctx.font = '22px system-ui, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText(score, WIDTH/2, 42);
  ctx.restore();

  if(state === 'playing'){
    rafId = requestAnimationFrame(loop);
  } else {
    cancelAnimationFrame(rafId);
  }
}

/* ---------- Input handlers ---------- */
canvas.addEventListener('pointerdown', (e) => {
  e.preventDefault();
  if(state === 'menu'){
    startFromMenu();
  } else if(state === 'playing'){
    flap();
  }
});

document.addEventListener('keydown', (e) => {
  if(e.code === 'Space' || e.key === ' ' || e.key === 'ArrowUp'){
    e.preventDefault();
    if(state === 'menu') startFromMenu();
    else if(state === 'playing') flap();
  }
});

/* Buttons */
playBtn.addEventListener('click', startFromMenu);
creditsBtn.addEventListener('click', ()=> {
  menuPanel.innerHTML = `
    <h1>About</h1>
    <p class="sub">Single-file Flappy demo. Built with canvas â€” mobile friendly.</p>
    <button class="btn btn-play" id="backBtn">Back</button>
  `;
  document.getElementById('backBtn').addEventListener('click', showMenu);
});

/* ---------- Start: show menu ---------- */
showMenu();
drawOnce(); // draw initial frame
</script>
</body>
</html>